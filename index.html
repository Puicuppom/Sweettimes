<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sweet Times üíñ</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Itim&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body { font-family: 'Itim', cursive; }
        .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-rose-50">

    <!-- HTML ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
    <div id="login-section" class="min-h-screen flex items-center justify-center p-4">
        <!-- ... -->
    </div>
    <div id="diary-section" class="hidden min-h-screen p-4 sm:p-8">
        <div class="max-w-3xl mx-auto">
            <!-- ... -->
        </div>
    </div>


    <!-- JavaScript Logic (‡∏â‡∏ö‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå) -->
    <script>
        // =================================================================
        //  ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è  ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL, KEY, ‡πÅ‡∏•‡∏∞ USER IDs ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà  ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è
        // =================================================================
        const SUPABASE_URL = 'YOUR_SUPABASE_URL';
        const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY';
        const USER_IDS = {
            Pui: 'YOUR_PUI_USER_ID_HERE',
            Noon: 'YOUR_NOON_USER_ID_HERE'
        };
        // =================================================================
        
        const { createClient } = supabase;
        const db = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const loginSection = document.getElementById('login-section');
        const diarySection = document.getElementById('diary-section');
        const loginForm = document.getElementById('login-form');
        const errorMessage = document.getElementById('error-message');
        const logoutButton = document.getElementById('logout-button');
        const datesList = document.getElementById('dates-list');
        const showFormButton = document.getElementById('show-form-button');
        const newDateFormContainer = document.getElementById('new-date-form-container');
        const newDateForm = document.getElementById('new-date-form');
        const cancelNewDateButton = document.getElementById('cancel-new-date');
        
        let currentUser = null;
        let activeTab = 'upcoming';
        let currentPage = 0;
        const PAGE_SIZE = 5;

        // ... ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô formatDate, getStatusBadge, getResponseNoteHTML, updateTabCounts, renderTabs, renderPagination ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ...
        const formatDate = (d) => { if(!d) return ''; const dt = new Date(d); return dt.toLocaleDateString('th-TH', { year:'numeric', month:'long', day:'numeric' }) + ' ‡πÄ‡∏ß‡∏•‡∏≤ ' + dt.toLocaleTimeString('th-TH', { hour:'2-digit', minute:'2-digit', hour12:false }) + ' ‡∏ô.'; };
        const getStatusBadge = (s) => { switch(s){ case 'accepted': return '<span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-1 rounded-full">‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</span>'; case 'declined': return '<span class="bg-red-100 text-red-800 text-xs font-medium px-2.5 py-1 rounded-full">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</span>'; default: return '<span class="bg-yellow-100 text-yellow-800 text-xs font-medium px-2.5 py-1 rounded-full">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö</span>';}};
        const getResponseNoteHTML = (d) => { if(!d.response_note) return ''; if(d.status === 'accepted'){ return `<p class="mt-2 text-sm text-green-700 bg-green-50 p-2 rounded-md">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö: ${d.response_note}</p>`; } if(d.status === 'declined'){ return `<p class="mt-2 text-sm text-red-600 bg-red-50 p-2 rounded-md">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ${d.response_note}</p>`; } return '';};
        const updateTabCounts = async () => { if(!currentUser)return; const {data,error}=await db.rpc('get_date_counts'); if(error){console.error("Error fetching tab counts:",error);return;} if(!data)return; const counts={pending:data.pending,upcoming:data.upcoming,past:data.past}; for(const key in counts){ const countBadge=document.getElementById(`count-${key}`); if(counts[key]>0){ countBadge.textContent=counts[key]; countBadge.classList.remove('hidden'); } else { countBadge.classList.add('hidden'); }}};
        const renderTabs = () => { document.querySelectorAll('.tab-button').forEach(b=>{b.classList.remove('border-rose-500','text-rose-600');b.classList.add('border-transparent','text-gray-500','hover:text-gray-700','hover:border-gray-300');}); const btn=document.getElementById(`tab-${activeTab}`);btn.classList.add('border-rose-500','text-rose-600');btn.classList.remove('border-transparent','text-gray-500','hover:text-gray-700','hover:border-gray-300');};
        const renderPagination = (total) => { const ctrls=document.getElementById('pagination-controls'); if(!total||total<=PAGE_SIZE){ctrls.classList.add('hidden');return;} ctrls.classList.remove('hidden'); const info=document.getElementById('page-info'); const pages=Math.ceil(total/PAGE_SIZE); info.textContent=`‡∏´‡∏ô‡πâ‡∏≤ ${currentPage+1} / ${pages}`; document.getElementById('prev-button').disabled=(currentPage===0); document.getElementById('next-button').disabled=(currentPage+1>=pages);};

        // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô fetchAndRenderDates ‡∏â‡∏ö‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
        const fetchAndRenderDates = async () => {
            if (!currentUser) return;
            datesList.innerHTML = '<p class="text-center text-gray-500 p-10">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î... üíñ</p>';
            renderTabs();
            document.getElementById('pagination-controls').classList.add('hidden');

            let query = db.from('sweet_dates').select('*', { count: 'exact' });
            const now = new Date().toISOString().slice(0, 19).replace('T', ' ');

            if (activeTab === 'pending') {
                query = query.eq('status', 'pending').or(`creator_id.eq.${currentUser.id},invitee_id.eq.${currentUser.id}`);
            } else if (activeTab === 'upcoming') {
                query = query.eq('status', 'accepted').gte('event_datetime', now).or(`creator_id.eq.${currentUser.id},invitee_id.eq.${currentUser.id}`);
            } else if (activeTab === 'past') {
                query = query.lt('event_datetime', now).or(`creator_id.eq.${currentUser.id},invitee_id.eq.${currentUser.id}`);
            }
            
            query = query.order('event_datetime', { ascending: activeTab !== 'past' })
                         .range(currentPage * PAGE_SIZE, (currentPage + 1) * PAGE_SIZE - 1);

            const { data, error, count } = await query;

            if (error) {
                console.error('Error fetching dates:', error);
                datesList.innerHTML = `<p class="text-center text-red-500 bg-white p-6 rounded-xl">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}</p>`;
                return;
            }
            renderPagination(count || 0);

            if (!data || data.length === 0) {
                datesList.innerHTML = '<p class="text-center text-gray-500 bg-white p-6 rounded-xl">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ</p>';
                return;
            }
            
            datesList.innerHTML = '';
            data.forEach(date => {
                const isCreator = date.creator_id === currentUser.id;
                const isInvitee = date.invitee_id === currentUser.id;
                
                let responseButtons = '';
                if (isInvitee && date.status === 'pending') {
                    responseButtons = `<div class="flex space-x-2"><button onclick="handleResponse(${date.id}, true)" class="bg-green-500 text-white px-3 py-1 text-sm rounded-lg hover:bg-green-600">‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö</button><button onclick="handleResponse(${date.id}, false)" class="bg-red-500 text-white px-3 py-1 text-sm rounded-lg hover:bg-red-600">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button></div>`;
                }
                
                let actionButtons = '';
                if (date.status !== 'declined' && new Date(date.event_datetime) > new Date()) {
                    actionButtons += `<button onclick='handleEdit(${JSON.stringify(date)})' class="p-1 text-gray-400 hover:text-blue-500" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg></button>`;
                }
                if (isCreator) {
                    actionButtons += `<button onclick="deleteDate(${date.id})" class="p-1 text-gray-400 hover:text-red-500" title="‡∏•‡∏ö"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg></button>`;
                }

                const dateCard = `<div class="relative bg-white p-6 rounded-2xl shadow-md border-l-4 ${date.status === 'accepted' ? 'border-green-400' : date.status === 'declined' ? 'border-red-400' : 'border-yellow-400'} animate-fade-in flex flex-col"><div class="absolute top-4 right-4 flex space-x-2">${actionButtons}</div><div class="flex-grow"><p class="text-sm text-gray-400">${formatDate(date.event_datetime)}</p><h2 class="text-2xl font-bold text-gray-800 mt-1">${date.title}</h2><p class="text-sm text-gray-500 mt-1">‡∏ä‡∏ß‡∏ô‡πÇ‡∏î‡∏¢: ${date.creator_name}</p><p class="text-gray-600 mt-2">${date.description || ''}</p>${getResponseNoteHTML(date)}</div><div class="mt-4 flex justify-between items-center"><div>${responseButtons}</div><div>${getStatusBadge(date.status)}</div></div></div>`;
                datesList.innerHTML += dateCard;
            });
        };

        window.handleEdit = (date) => {
            const form = document.getElementById('new-date-form');
            form.reset();
            document.getElementById('editing-date-id').value = date.id;
            document.getElementById('form-title').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢';
            document.getElementById('save-date-button').textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
            document.getElementById('creator-name').value = date.creator_name;
            document.getElementById('creator-name').disabled = true;
            document.getElementById('title').value = date.title;
            document.getElementById('description').value = date.description;
            const localDateTime = new Date(new Date(date.event_datetime).getTime() - (new Date().getTimezoneOffset() * 60000)).toISOString().slice(0, 16);
            document.getElementById('event-datetime').value = localDateTime;
            document.getElementById('new-date-form-container').classList.remove('hidden');
            document.getElementById('show-form-button').classList.add('hidden');
            window.scrollTo(0, 0);
        };
        
        window.changeTab = (tabName) => { activeTab = tabName; currentPage = 0; fetchAndRenderDates(); };
        window.changePage = (direction) => { currentPage += direction; fetchAndRenderDates(); };

        window.handleResponse = async (dateId, accepted) => {
            const promptMessage = accepted ? "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡πÜ ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏™‡∏¥:" : "‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò:";
            const defaultText = accepted ? "‡πÑ‡∏õ‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô! ü•∞" : "";
            const note = prompt(promptMessage, defaultText);
            
            if (note === null) { return; }

            let updateData = { status: accepted ? 'accepted' : 'declined', response_note: note };
            
            const { error } = await db.from('sweet_dates').update(updateData).match({ id: dateId });
            if (error) { alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message); }
            else { await updateTabCounts(); fetchAndRenderDates(); }
        };

        window.deleteDate = async (dateId) => {
            if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ô‡∏µ‡πâ?")) {
                const { error } = await db.from('sweet_dates').delete().match({ id: dateId });
                if (error) { alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message); }
                else { await updateTabCounts(); fetchAndRenderDates(); }
            }
        };
        
        const showDiaryPage = async () => {
            const { data } = await db.auth.getUser();
            currentUser = data.user;
            if (currentUser) {
                loginSection.classList.add('hidden');
                diarySection.classList.remove('hidden');
                await updateTabCounts();
                changeTab('upcoming');
            } else { showLoginPage(); }
        };

        const showLoginPage = () => {
            currentUser = null;
            loginSection.classList.remove('hidden');
            diarySection.classList.add('hidden');
        };

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginButton = document.getElementById('login-button');
            loginButton.disabled = true;
            loginButton.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...';
            errorMessage.classList.add('hidden');
            const { data, error } = await db.auth.signInWithPassword({ email, password });
            if (error) {
                console.error("Login Error:", error);
                errorMessage.textContent = `Login ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${error.message}`;
                errorMessage.classList.remove('hidden');
                loginButton.disabled = false;
                loginButton.textContent = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
            } else if (data.session) { showDiaryPage(); }
        });
        
        logoutButton.addEventListener('click', async () => {
            await db.auth.signOut();
            showLoginPage();
        });
        
        showFormButton.addEventListener('click', () => {
            const form = document.getElementById('new-date-form');
            form.reset();
            document.getElementById('editing-date-id').value = '';
            document.getElementById('form-title').textContent = '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà';
            document.getElementById('save-date-button').textContent = '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç';
            document.getElementById('creator-name').disabled = false;
            newDateFormContainer.classList.remove('hidden');
            showFormButton.classList.add('hidden');
        });
        
        cancelNewDateButton.addEventListener('click', () => {
            newDateFormContainer.classList.add('hidden');
            showFormButton.classList.remove('hidden');
            newDateForm.reset();
        });
        
        newDateForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login ‡πÉ‡∏´‡∏°‡πà'); return; }
            const saveButton = document.getElementById('save-date-button');
            saveButton.disabled = true;
            saveButton.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';

            const editingId = document.getElementById('editing-date-id').value;
            const isEditing = !!editingId;

            const creatorName = document.getElementById('creator-name').value;
            if (!creatorName) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏ä‡∏ß‡∏ô');
                saveButton.disabled = false;
                saveButton.textContent = isEditing ? '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç' : '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç';
                return;
            }

            if (USER_IDS.Pui.includes('YOUR_') || USER_IDS.Noon.includes('YOUR_')) {
                 alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ User ID ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î JavaScript ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö!');
                 saveButton.disabled = false;
                 saveButton.textContent = isEditing ? '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç' : '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç';
                 return;
            }
            
            const dateData = {
                creator_name: creatorName,
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                event_datetime: document.getElementById('event-datetime').value,
            };

            if (!isEditing) {
                const inviteeName = creatorName === 'Pui' ? 'Noon' : 'Pui';
                const inviteeId = USER_IDS[inviteeName];
                if (currentUser.id === inviteeId) {
                    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                    saveButton.disabled = false;
                    saveButton.textContent = '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç';
                    return;
                }
                dateData.creator_id = currentUser.id;
                dateData.invitee_id = inviteeId;
                dateData.status = 'pending';
            }

            let error;
            if (isEditing) {
                const { error: updateError } = await db.from('sweet_dates').update(dateData).match({ id: editingId });
                error = updateError;
            } else {
                const { error: insertError } = await db.from('sweet_dates').insert([dateData]);
                error = insertError;
            }

            if (error) {
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
                console.error("Submit Error:", error);
            } else {
                newDateForm.reset();
                newDateFormContainer.classList.add('hidden');
                showFormButton.classList.remove('hidden');
                await updateTabCounts();
                changeTab(isEditing ? activeTab : 'pending');
            }
            
            saveButton.disabled = false;
            document.getElementById('editing-date-id').value = '';
            document.getElementById('form-title').textContent = '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà';
            document.getElementById('creator-name').disabled = false;
            saveButton.textContent = '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç';
        });
        
        const checkSession = async () => {
            if (!SUPABASE_URL || SUPABASE_URL.includes('YOUR_SUPABASE_URL')) {
                document.body.innerHTML = '<div class="text-red-600 text-2xl text-center p-10">‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ SUPABASE_URL ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î</div>';
                return;
            }
            const { data: { session } } = await db.auth.getSession();
            if (session) { showDiaryPage(); }
            else { showLoginPage(); }
        };

        checkSession();
    </script>
</body>
</html>
