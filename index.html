<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sweet Times üíñ</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Itim&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body { font-family: 'Itim', cursive; }
        .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-rose-50">

    <!-- Login Section -->
    <div id="login-section" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-sm text-center">
            <h1 class="text-4xl font-bold text-rose-500 mb-2">Sweet Times</h1>
            <p class="text-gray-500 mb-6">üíñ ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏ß‡∏µ‡∏ó‡∏Ç‡∏≠‡∏á‡∏™‡∏≠‡∏á‡πÄ‡∏£‡∏≤ üíñ</p>
            <form id="login-form">
                <div class="mb-4 text-left">
                    <label class="block text-gray-700 mb-1" for="email">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                    <input id="email" type="email" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-400" required />
                </div>
                <div class="mb-6 text-left">
                    <label class="block text-gray-700 mb-1" for="password">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <input id="password" type="password" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-400" required />
                </div>
                <p id="error-message" class="text-red-500 text-center mb-4 hidden"></p>
                <button type="submit" id="login-button" class="w-full bg-rose-500 text-white py-2 rounded-lg hover:bg-rose-600 transition-colors disabled:bg-rose-300">
                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </form>
        </div>
    </div>

    <!-- Diary Section -->
    <div id="diary-section" class="hidden min-h-screen p-4 sm:p-8">
        <div class="max-w-3xl mx-auto">
            <header class="flex justify-between items-center mb-8">
                <div>
                    <h1 class="text-4xl font-bold text-rose-500">Sweet Times</h1>
                    <p class="text-gray-500">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏ß‡∏µ‡∏ó‡∏Ç‡∏≠‡∏á‡∏™‡∏≠‡∏á‡πÄ‡∏£‡∏≤</p>
                </div>
                <button id="logout-button" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300">
                    ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </header>

            <!-- New Date Form -->
            <div id="new-date-form-container" class="bg-white p-6 rounded-2xl shadow-md mb-8 hidden">
                 <h2 class="text-2xl font-bold text-rose-500 mb-4 text-center">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</h2>
                 <form id="new-date-form" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 mb-1">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ä‡∏ß‡∏ô</label>
                        <input id="invitee-email" type="email" placeholder="‡πÉ‡∏™‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡πÅ‡∏ü‡∏ô‡∏Ñ‡∏∏‡∏ì" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-400" required />
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏Ñ‡∏ô‡∏ä‡∏ß‡∏ô)</label>
                        <input id="creator-name" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡∏•‡∏≠‡∏¢, ‡πÅ‡∏ö‡∏á‡∏Ñ‡πå" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-400" required />
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</label>
                        <input id="title" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏õ‡πÄ‡∏î‡∏ó‡∏î‡∏π‡∏î‡∏≤‡∏ß‡∏Å‡∏±‡∏ô! ‚ú®" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-400" required />
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏ô‡πâ‡∏≠‡∏¢‡πÜ</label>
                        <textarea id="description" placeholder="‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡∏≠‡∏ô‡∏î‡∏π‡∏î‡∏≤‡∏ß‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡∏ô‡∏∞ üòä" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-400"></textarea>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</label>
                        <input id="event-datetime" type="datetime-local" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-400" required />
                    </div>
                    <div class="flex items-center justify-end pt-2 space-x-4">
                         <button type="button" id="cancel-new-date" class="text-gray-600 hover:text-rose-500">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                         <button type="submit" id="save-date-button" class="bg-rose-500 text-white px-6 py-2 rounded-lg hover:bg-rose-600 transition-colors">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç</button>
                    </div>
                 </form>
            </div>
            
            <div class="text-center mb-8">
                <button id="show-form-button" class="bg-rose-500 text-white px-8 py-3 rounded-full text-lg shadow-md hover:bg-rose-600 transition-all transform hover:scale-105 inline-block">
                    + ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà
                </button>
            </div>

            <!-- Dates List -->
            <div id="dates-list" class="space-y-4"></div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        const SUPABASE_URL = 'YOUR_SUPABASE_URL';
        const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY';
        
        const { createClient } = supabase;
        const db = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // DOM Elements
        const loginSection = document.getElementById('login-section');
        const diarySection = document.getElementById('diary-section');
        const loginForm = document.getElementById('login-form');
        const logoutButton = document.getElementById('logout-button');
        const datesList = document.getElementById('dates-list');
        const showFormButton = document.getElementById('show-form-button');
        const newDateFormContainer = document.getElementById('new-date-form-container');
        const newDateForm = document.getElementById('new-date-form');
        const cancelNewDateButton = document.getElementById('cancel-new-date');
        
        let currentUser = null;

        const formatDate = (dateString) => {
            const date = new Date(dateString);
            return date.toLocaleDateString('th-TH', {
                year: 'numeric', month: 'long', day: 'numeric'
            }) + ' ‡πÄ‡∏ß‡∏•‡∏≤ ' + date.toLocaleTimeString('th-TH', {
                hour: '2-digit', minute: '2-digit', hour12: false
            }) + ' ‡∏ô.';
        };
        
        const getStatusBadge = (status) => {
            switch(status) {
                case 'accepted': return '<span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-1 rounded-full">‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</span>';
                case 'declined': return '<span class="bg-red-100 text-red-800 text-xs font-medium px-2.5 py-1 rounded-full">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</span>';
                default: return '<span class="bg-yellow-100 text-yellow-800 text-xs font-medium px-2.5 py-1 rounded-full">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö</span>';
            }
        };

        const fetchAndRenderDates = async () => {
            if (!currentUser) return;
            datesList.innerHTML = '<p class="text-center text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥... üíñ</p>';
            
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤ (‡∏ó‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏ä‡∏ß‡∏ô)
            const { data, error } = await db
                .from('sweet_dates')
                .select('*')
                .or(`creator_id.eq.${currentUser.id},invitee_id.eq.${currentUser.id}`)
                .order('event_datetime', { ascending: false });

            if (error) {
                console.error('Error fetching dates:', error);
                datesList.innerHTML = '<p class="text-center text-red-500">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</p>';
                return;
            }

            if (data.length === 0) {
                datesList.innerHTML = '<p class="text-center text-gray-500 bg-white p-6 rounded-xl">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏¢‡∏ô‡∏∞ ‡∏°‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡πÅ‡∏£‡∏Å‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞!</p>';
                return;
            }
            
            datesList.innerHTML = '';
            data.forEach(date => {
                const isCreator = date.creator_id === currentUser.id;
                const isInvitee = date.invitee_id === currentUser.id;
                
                let actionButtons = '';
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏ñ‡∏π‡∏Å‡∏ä‡∏ß‡∏ô ‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏î‡∏¢‡∏±‡∏á‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö
                if (isInvitee && date.status === 'pending') {
                    actionButtons = `
                        <div class="mt-4 flex space-x-2">
                            <button onclick="handleResponse(${date.id}, true)" class="bg-green-500 text-white px-3 py-1 text-sm rounded-lg hover:bg-green-600">‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö</button>
                            <button onclick="handleResponse(${date.id}, false)" class="bg-red-500 text-white px-3 py-1 text-sm rounded-lg hover:bg-red-600">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
                        </div>
                    `;
                }
                
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á
                if (isCreator) {
                     actionButtons += `
                        <button onclick="deleteDate(${date.id})" class="absolute top-4 right-4 text-gray-400 hover:text-red-500">Ôóë</button>
                     `;
                }

                const dateCard = `
                    <div class="relative bg-white p-6 rounded-2xl shadow-md border-l-4 ${date.status === 'accepted' ? 'border-green-400' : date.status === 'declined' ? 'border-red-400' : 'border-yellow-400'} animate-fade-in">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-sm text-gray-400">${formatDate(date.event_datetime)}</p>
                                <h2 class="text-2xl font-bold text-gray-800 mt-1">${date.title}</h2>
                                <p class="text-sm text-gray-500 mt-1">‡∏ä‡∏ß‡∏ô‡πÇ‡∏î‡∏¢: ${date.creator_name}</p>
                            </div>
                            <div>${getStatusBadge(date.status)}</div>
                        </div>
                        <p class="text-gray-600 mt-2">${date.description || ''}</p>
                        ${date.status === 'declined' && date.response_reason ? `<p class="mt-2 text-sm text-red-600 bg-red-50 p-2 rounded-md">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ${date.response_reason}</p>` : ''}
                        ${actionButtons}
                    </div>
                `;
                datesList.innerHTML += dateCard;
            });
        };

        window.handleResponse = async (dateId, accepted) => {
            let updateData = { status: accepted ? 'accepted' : 'declined' };
            if (!accepted) {
                const reason = prompt("‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò:", "");
                if (reason !== null) { // ‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏Å‡∏î‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    updateData.response_reason = reason;
                }
            }

            const { error } = await db.from('sweet_dates').update(updateData).match({ id: dateId });
            if (error) alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            else fetchAndRenderDates();
        };

        window.deleteDate = async (dateId) => {
            if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ô‡∏µ‡πâ?")) {
                const { error } = await db.from('sweet_dates').delete().match({ id: dateId });
                if (error) alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
                else fetchAndRenderDates();
            }
        };

        const showDiaryPage = async () => {
            const { data } = await db.auth.getUser();
            currentUser = data.user;
            loginSection.classList.add('hidden');
            diarySection.classList.remove('hidden');
            fetchAndRenderDates();
        };

        const showLoginPage = () => {
            currentUser = null;
            loginSection.classList.remove('hidden');
            diarySection.classList.add('hidden');
        };

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const { error } = await db.auth.signInWithPassword({ email, password });
            if (error) {
                document.getElementById('error-message').textContent = '‡∏≠‡∏∏‡πä‡∏õ‡∏™‡πå! ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏∞';
                document.getElementById('error-message').classList.remove('hidden');
            } else {
                showDiaryPage();
            }
        });
        
        logoutButton.addEventListener('click', async () => {
            await db.auth.signOut();
            showLoginPage();
        });
        
        showFormButton.addEventListener('click', () => {
            newDateFormContainer.classList.remove('hidden');
            showFormButton.classList.add('hidden');
        });
        
        cancelNewDateButton.addEventListener('click', () => {
            newDateFormContainer.classList.add('hidden');
            showFormButton.classList.remove('hidden');
            newDateForm.reset();
        });
        
        newDateForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login ‡πÉ‡∏´‡∏°‡πà'); return; }

            // ‡∏´‡∏≤ invitee_id ‡∏à‡∏≤‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•
            const inviteeEmail = document.getElementById('invitee-email').value;
            // ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á profiles ‡πÄ‡∏£‡∏≤‡∏à‡∏∂‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏´‡∏≤ id ‡∏à‡∏≤‡∏Å email ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
            // **‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢:** ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ ID ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ü‡∏ô‡πÄ‡∏£‡∏≤‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á DB
            // **‡πÅ‡∏ï‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡∏£‡∏π‡πâ user ID ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ü‡∏ô**
            // **‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏ô‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏à‡∏£‡∏¥‡∏á**
            // **‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏´‡∏≤ User ID ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ü‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏à‡∏≤‡∏Å Supabase > Authentication > Users ‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà 'USER_ID_OF_YOUR_PARTNER'**
            
            // ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡πÅ‡∏Ñ‡πà 2 user
            // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏î‡∏µ‡∏ô‡∏±‡∏Å ‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏ì‡∏µ 2 ‡∏Ñ‡∏ô
            alert("‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà User ID ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ü‡∏ô‡∏Ñ‡∏∏‡∏ì‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á");
            return; 

            // **‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô ‡∏´‡∏≤‡∏Å‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á profiles**
            /*
            const { data: inviteeData, error: inviteeError } = await db.from('profiles').select('id').eq('email', inviteeEmail).single();
            if (inviteeError || !inviteeData) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏¥‡∏ç!');
                return;
            }

            const newDate = {
                creator_id: currentUser.id,
                invitee_id: inviteeData.id, // ‡πÉ‡∏ä‡πâ id ‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏°‡∏≤‡πÑ‡∏î‡πâ
                creator_name: document.getElementById('creator-name').value,
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                event_datetime: document.getElementById('event-datetime').value,
                status: 'pending'
            };
            
            const { error } = await db.from('sweet_dates').insert([newDate]);
            if (error) alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            else {
                newDateForm.reset();
                newDateFormContainer.classList.add('hidden');
                showFormButton.classList.remove('hidden');
                fetchAndRenderDates();
            }
            */
        });
        
        const checkSession = async () => {
            const { data: { session } } = await db.auth.getSession();
            if (session) {
                showDiaryPage();
            } else {
                showLoginPage();
            }
        };

        checkSession();
    </script>
</body>
</html>
