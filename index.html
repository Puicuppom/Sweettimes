<!DOCTYPE html>
<html lang="th">
<head>
    <!-- ... ‡∏™‡πà‡∏ß‡∏ô Head ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏£ ... -->
</head>
<body class="bg-rose-50">

    <!-- ... ‡∏™‡πà‡∏ß‡∏ô Login ‡πÅ‡∏•‡∏∞ Form ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏£ ... -->

    <!-- Diary Section (‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) -->
    <div id="diary-section" class="hidden min-h-screen p-4 sm:p-8">
        <div class="max-w-3xl mx-auto">
            <!-- ... ‡∏™‡πà‡∏ß‡∏ô Header ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ... -->

            <!-- ‚úÖ  ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà -->
            <div class="mb-6 border-b border-gray-200">
                <nav class="flex space-x-4" aria-label="Tabs">
                    <button id="tab-pending" onclick="changeTab('pending')" class="tab-button px-3 py-2 font-medium text-sm rounded-t-lg border-b-2">
                        ‡∏£‡∏≠‡πÄ‡∏£‡∏≤‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö
                    </button>
                    <button id="tab-upcoming" onclick="changeTab('upcoming')" class="tab-button px-3 py-2 font-medium text-sm rounded-t-lg border-b-2">
                        ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ñ‡∏∂‡∏á
                    </button>
                    <button id="tab-past" onclick="changeTab('past')" class="tab-button px-3 py-2 font-medium text-sm rounded-t-lg border-b-2">
                        ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥
                    </button>
                </nav>
            </div>

            <!-- ... ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ... -->
            
            <!-- Dates List -->
            <div id="dates-list" class="space-y-4"></div>

            <!-- ‚úÖ  ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏∏‡πà‡∏° Pagination ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà -->
            <div id="pagination-controls" class="mt-8 flex justify-between items-center hidden">
                <button id="prev-button" onclick="changePage(-1)" class="bg-white text-gray-700 px-4 py-2 rounded-lg shadow hover:bg-gray-100 disabled:opacity-50">
                    ‚Üê ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                </button>
                <span id="page-info" class="text-gray-600"></span>
                <button id="next-button" onclick="changePage(1)" class="bg-white text-gray-700 px-4 py-2 rounded-lg shadow hover:bg-gray-100 disabled:opacity-50">
                    ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic (‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) -->
    <script>
        // ... (‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Supabase ‡πÅ‡∏•‡∏∞ DOM Elements ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ...
        
        // ‚úÖ  ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤
        let activeTab = 'upcoming'; // ‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        let currentPage = 0; // ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 0)
        const PAGE_SIZE = 5; // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ó‡∏µ‡∏•‡∏∞ 5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£

        // ... (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô formatDate, getStatusBadge, getResponseNoteHTML ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ...

        const renderTabs = () => {
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('border-rose-500', 'text-rose-600');
                button.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            });
            const currentTabButton = document.getElementById(`tab-${activeTab}`);
            currentTabButton.classList.add('border-rose-500', 'text-rose-600');
            currentTabButton.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
        };

        const renderPagination = (totalItems) => {
            const paginationControls = document.getElementById('pagination-controls');
            if (totalItems <= PAGE_SIZE) {
                paginationControls.classList.add('hidden');
                return;
            }
            paginationControls.classList.remove('hidden');

            const pageInfo = document.getElementById('page-info');
            const totalPages = Math.ceil(totalItems / PAGE_SIZE);
            pageInfo.textContent = `‡∏´‡∏ô‡πâ‡∏≤ ${currentPage + 1} / ${totalPages}`;

            document.getElementById('prev-button').disabled = (currentPage === 0);
            document.getElementById('next-button').disabled = (currentPage + 1 >= totalPages);
        };

        const fetchAndRenderDates = async () => {
            if (!currentUser) return;
            datesList.innerHTML = '<p class="text-center text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î... üíñ</p>';
            renderTabs();

            let query = db.from('sweet_dates').select('*', { count: 'exact' }); // { count: 'exact' } ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ï‡∏≤‡∏°‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            const now = new Date().toISOString();
            if (activeTab === 'pending') {
                query = query.eq('invitee_id', currentUser.id).eq('status', 'pending');
            } else if (activeTab === 'upcoming') {
                query = query.eq('status', 'accepted').gte('event_datetime', now)
                             .or(`creator_id.eq.${currentUser.id},invitee_id.eq.${currentUser.id}`);
            } else if (activeTab === 'past') {
                query = query.lt('event_datetime', now)
                             .or(`creator_id.eq.${currentUser.id},invitee_id.eq.${currentUser.id}`);
            }

            // ‡πÉ‡∏ä‡πâ Pagination
            query = query.order('event_datetime', { ascending: activeTab !== 'past' })
                         .range(currentPage * PAGE_SIZE, (currentPage + 1) * PAGE_SIZE - 1);

            const { data, error, count } = await query;

            if (error) { /* ... ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ... */ }
            renderPagination(count || 0);
            
            if (!data || data.length === 0) {
                datesList.innerHTML = '<p class="text-center text-gray-500 bg-white p-6 rounded-xl">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ</p>';
                return;
            }
            
            // ... (‡∏™‡πà‡∏ß‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î render ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏£) ...
        };

        window.changeTab = (tabName) => {
            activeTab = tabName;
            currentPage = 0; // Reset ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà 0 ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏ó‡πá‡∏ö
            fetchAndRenderDates();
        };

        window.changePage = (direction) => {
            currentPage += direction;
            fetchAndRenderDates();
        };

        // ... (‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î) ...

        const showDiaryPage = async () => {
            // ...
            changeTab('upcoming'); // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ login ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö upcoming
        };

    </script>
</body>
</html>
